//
// Dust - Asynchronous Templating v0.3.0
// http://akdubya.github.com/dustjs
//
// Copyright (c) 2010, Aleksander Williams
// Released under the MIT License.
//

function startTimeBlurFunction(e){var t=$(e).val();!t==""&&(context.player.options.areaSelectionEnabled||enableTemporalComment(context.player,!0,globalStartTimeInput,globalEndTimeInput),context.player.setAreaSelectionStartTime(t),context.player.seek(t))}function endTimeBlurFunction(e){var t=$(e).val();if(!$(e).val()==""){var n=$(e).parents().find("#PostFormFromThread_startTime").val();n==""&&($("#PostFormFromThread_startTime").val(t-1),context.player.setAreaSelectionStartTime(t-1)),t>context.player.getDuration()&&(t=context.player.getDuration()),context.player.options.areaSelectionEnabled?context.player.seek(Math.max(1,t)):(context.player.seek(Math.max(1,t-1)),enableTemporalComment(context.player,!0,globalStartTimeInput,globalEndTimeInput)),context.player.setAreaSelectionEndTime(t)}}function enableTemporalComment(e,t,n,r){controls=e,startTimeInput=n,endTimeInput=r,e.pause(),controls.oldPlayHeadImage=e.options.playHeadImage,t?(controls.playHeadImage=undefined,Number(controls.getCurrentTime())+controls.options.minLinkTime>controls.getDuration()?controls.currentMinTimeSelected=controls.getDuration()-controls.options.minLinkTime:controls.currentMinTimeSelected=controls.getCurrentTime(),controls.currentMinSelected=controls.getXForTime(controls.currentMinTimeSelected),controls.currentMaxTimeSelected=Number(controls.currentMinTimeSelected)+controls.options.minLinkTime,controls.currentMaxSelected=controls.getXForTime(controls.currentMaxTimeSelected),controls.setAreaSelectionEnabled(!0),startTimeInput.val(Math.roundPrecise(controls.currentMinTimeSelected,2)),startTimeInput.on("change",function(){startTimeInput.val()>=controls.currentMaxTimeSelected-controls.options.minLinkTime?startTimeInput.val()>=controls.getDuration()-controls.options.minLinkTime?(controls.currentMaxTimeSelected=controls.getDuration(),controls.currentMinTimeSelected=controls.currentMaxTimeSelected-controls.options.minLinkTime,controls.currentMinSelected=controls.getXForTime(controls.currentMinTimeSelected),controls.currentMaxSelected=controls.getXForTime(controls.currentMaxTimeSelected),endTimeInput.val(Math.roundPrecise(controls.currentMaxTimeSelected,2)),startTimeInput.val(Math.roundPrecise(controls.currentMinTimeSelected,2))):(controls.currentMinTimeSelected=startTimeInput.val(),controls.currentMinSelected=controls.getXForTime(controls.currentMinTimeSelected),controls.currentMaxTimeSelected=Number(controls.currentMinTimeSelected)+controls.options.minLinkTime,controls.currentMaxSelected=controls.getXForTime(controls.currentMaxTimeSelected),endTimeInput.val(Math.roundPrecise(controls.currentMaxTimeSelected,2))):startTimeInput.val()<=0?(controls.currentMinTimeSelected=0,controls.currentMinSelected=controls.getXForTime(controls.currentMinTimeSelected),startTimeInput.val(Math.roundPrecise(controls.currentMinTimeSelected,2))):(controls.currentMinTimeSelected=startTimeInput.val(),controls.currentMinSelected=controls.getXForTime(controls.currentMinTimeSelected)),controls.setHighlightedRegion(controls.currentMinSelected,controls.currentMaxSelected),controls.seek(controls.currentMinTimeSelected)}),endTimeInput.val(Math.roundPrecise(controls.currentMaxTimeSelected,2)),endTimeInput.on("change",function(){endTimeInput.val()<=Number(controls.currentMinTimeSelected)+controls.options.minLinkTime?endTimeInput.val()<controls.options.minLinkTime?(controls.currentMinTimeSelected=0,controls.currentMinSelected=controls.getXForTime(controls.currentMinTimeSelected),startTimeInput.val(Math.roundPrecise(controls.currentMinTimeSelected,2)),controls.currentMaxTimeSelected=Number(controls.currentMinTimeSelected)+controls.options.minLinkTime,controls.currentMaxSelected=controls.getXForTime(controls.currentMaxTimeSelected),endTimeInput.val(Math.roundPrecise(controls.currentMaxTimeSelected,2))):(controls.currentMaxTimeSelected=endTimeInput.val(),controls.currentMaxSelected=controls.getXForTime(controls.currentMaxTimeSelected),endTimeInput.val(Math.roundPrecise(controls.currentMaxTimeSelected,2)),controls.currentMinTimeSelected=controls.currentMaxTimeSelected-controls.options.minLinkTime,controls.currentMinSelected=controls.getXForTime(controls.currentMinTimeSelected),startTimeInput.val(Math.roundPrecise(controls.currentMinTimeSelected,2))):endTimeInput.val()>=controls.getDuration()?(controls.currentMaxTimeSelected=controls.getDuration(),controls.currentMaxSelected=controls.getXForTime(controls.currentMaxTimeSelected),endTimeInput.val(Math.roundPrecise(controls.currentMaxTimeSelected,2))):(controls.currentMaxTimeSelected=endTimeInput.val(),controls.currentMaxSelected=controls.getXForTime(controls.currentMaxTimeSelected)),controls.setHighlightedRegion(controls.currentMinSelected,controls.currentMaxSelected),controls.setVideoTime(controls.currentMaxTimeSelected)}),controls.repaint()):(controls.setPlayHeadImage(context.playerOptions.playHeadImage),controls.setAreaSelectionEnabled(!1),controls.currentMinSelected=controls.minSelected,controls.currentMinTimeSelected=controls.getTimeForX(controls.currentMinSelected),controls.currentMaxSelected=controls.maxSelected,controls.currentMaxTimeSelected=controls.getTimeForX(controls.currentMaxSelected),controls.repaint())}Function.prototype.extend=function(e){for(var t in e.prototype)this.prototype[t]=e.prototype[t];return this.prototype.constructor=this,this.prototype.parent=e.prototype,this},Math.roundPrecise=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},define("extra",function(){});var dust={};(function(o){function z(e,t,n){this.stack=e,this.global=t,this.blocks=n}function H(e,t,n,r){this.tail=t,this.isObject=!o.isArray(e)&&e&&typeof e=="object",this.head=e,this.index=n,this.of=r}function p(e){this.head=new B(this),this.callback=e,this.out=""}function J(){this.head=new B(this)}function B(e,t,n){this.root=e,this.next=t,this.data="",this.flushable=!1,this.taps=n}function r(e,t){this.head=e,this.tail=t}o.cache={},o.register=function(e,t){e&&(o.cache[e]=t)},o.render=function(e,t,n){n=(new p(n)).head,o.load(e,n,z.wrap(t)).end()},o.stream=function(e,t){var n=new J;return o.nextTick(function(){o.load(e,n.head,z.wrap(t)).end()}),n},o.renderSource=function(e,t,n){return o.compileFn(e)(t,n)},o.compileFn=function(e,t){var n=o.loadSource(o.compile(e,t));return function(e,t){var r=t?new p(t):new J;return o.nextTick(function(){n(r.head,z.wrap(e)).end()}),r}},o.load=function(e,t,n){var r=o.cache[e];return r?r(t,n):o.onLoad?t.map(function(t){o.onLoad(e,function(r,i){if(r)return t.setError(r);o.cache[e]||o.loadSource(o.compile(i,e)),o.cache[e](t,n).end()})}):t.setError(Error("Template Not Found: "+e))},o.loadSource=function(e){return eval(e)},o.isArray=Array.isArray?Array.isArray:function(e){return Object.prototype.toString.call(e)=="[object Array]"},o.nextTick=function(e){setTimeout(e,0)},o.isEmpty=function(e){return o.isArray(e)&&!e.length?!0:e===0?!1:!e},o.filter=function(e,t,n){if(n)for(var r=0,i=n.length;r<i;r++){var s=n[r];s==="s"?t=null:e=o.filters[s](e)}return t&&(e=o.filters[t](e)),e},o.filters={h:function(e){return o.escapeHtml(e)},j:function(e){return o.escapeJs(e)},u:encodeURI,uc:encodeURIComponent},o.makeBase=function(e){return new z(new H,e)},z.wrap=function(e){return e instanceof z?e:new z(new H(e))},z.prototype.get=function(e){for(var t=this.stack,n;t;){if(t.isObject){n=t.head[e];if(n!==undefined)return n}t=t.tail}return this.global?this.global[e]:undefined},z.prototype.getPath=function(e,t){var n=this.stack,r=t.length;if(e&&r===0)return n.head;if(n.isObject){n=n.head;for(var i=0;n&&i<r;)n=n[t[i]],i++;return n}},z.prototype.push=function(e,t,n){return new z(new H(e,this.stack,t,n),this.global,this.blocks)},z.prototype.rebase=function(e){return new z(new H(e),this.global,this.blocks)},z.prototype.current=function(){return this.stack.head},z.prototype.getBlock=function(e){var t=this.blocks;if(t)for(var n=t.length,r;n--;)if(r=t[n][e])return r},z.prototype.shiftBlocks=function(e){var t=this.blocks;return e?(newBlocks=t?t.concat([e]):[e],new z(this.stack,this.global,newBlocks)):this},p.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable){e.error&&(this.callback(e.error),this.flush=function(){});return}this.out+=e.data,this.head=e=e.next}this.callback(null,this.out)},J.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable){e.error&&(this.emit("error",e.error),this.flush=function(){});return}this.emit("data",e.data),this.head=e=e.next}this.emit("end")},J.prototype.emit=function(e,t){var n=this.events;n&&n[e]&&n[e](t)},J.prototype.on=function(e,t){return this.events||(this.events={}),this.events[e]=t,this},B.prototype.write=function(e){var t=this.taps;return t&&(e=t.go(e)),this.data+=e,this},B.prototype.end=function(e){return e&&this.write(e),this.flushable=!0,this.root.flush(),this},B.prototype.map=function(e){var t=new B(this.root,this.next,this.taps),n=new B(this.root,t,this.taps);return this.next=n,this.flushable=!0,e(n),t},B.prototype.tap=function(e){var t=this.taps;return this.taps=t?t.push(e):new r(e),this},B.prototype.untap=function(){return this.taps=this.taps.tail,this},B.prototype.render=function(e,t){return e(this,t)},B.prototype.reference=function(e,t,n,r){if(typeof e=="function"){e=e(this,t,null,{auto:n,filters:r});if(e instanceof B)return e}return o.isEmpty(e)?this:this.write(o.filter(e,n,r))},B.prototype.section=function(e,t,n,r){if(typeof e=="function"){e=e(this,t,n,r);if(e instanceof B)return e}var i=n.block;n=n["else"],r&&(t=t.push(r));if(o.isArray(e)){if(i){r=e.length,n=this;for(var s=0;s<r;s++)n=i(n,t.push(e[s],s,r));return n}}else if(e===!0){if(i)return i(this,t)}else if(e||e===0){if(i)return i(this,t.push(e))}else if(n)return n(this,t);return this},B.prototype.exists=function(e,t,n){var r=n.block;n=n["else"];if(o.isEmpty(e)){if(n)return n(this,t)}else if(r)return r(this,t);return this},B.prototype.notexists=function(e,t,n){var r=n.block;n=n["else"];if(o.isEmpty(e)){if(r)return r(this,t)}else if(n)return n(this,t);return this},B.prototype.block=function(e,t,n){return n=n.block,e&&(n=e),n?n(this,t):this},B.prototype.partial=function(e,t){return typeof e=="function"?this.capture(e,t,function(e,n){o.load(e,n,t).end()}):o.load(e,this,t)},B.prototype.helper=function(e,t,n,r){return o.helpers[e](this,t,n,r)},B.prototype.capture=function(e,t,n){return this.map(function(r){var i=new p(function(e,t){e?r.setError(e):n(t,r)});e(i.head,t).end()})},B.prototype.setError=function(e){return this.error=e,this.root.flush(),this},o.helpers={sep:function(e,t,n){return t.stack.index===t.stack.of-1?e:n.block(e,t)},idx:function(e,t,n){return n.block(e,t.push(t.stack.index))}},r.prototype.push=function(e){return new r(e,this)},r.prototype.go=function(e){for(var t=this;t;)e=t.head(e),t=t.tail;return e};var K=RegExp(/[&<>\"]/),q=/&/g,j=/</g,w=/>/g,t=/\"/g;o.escapeHtml=function(e){return typeof e=="string"?K.test(e)?e.replace(q,"&amp;").replace(j,"&lt;").replace(w,"&gt;").replace(t,"&quot;"):e:e};var y=/\\/g,A=/\r/g,F=/\u2028/g,L=/\u2029/g,N=/\n/g,V=/\f/g,I=/'/g,Q=/"/g,T=/\t/g;o.escapeJs=function(e){return typeof e=="string"?e.replace(y,"\\\\").replace(Q,'\\"').replace(I,"\\'").replace(A,"\\r").replace(F,"\\u2028").replace(L,"\\u2029").replace(N,"\\n").replace(V,"\\f").replace(T,"\\t"):e}})(dust),typeof exports!="undefined"&&(typeof process!="undefined"&&require("./server")(dust),module.exports=dust),function(e){function t(t,n){for(var r=[n[0]],i=1,s=n.length;i<s;i++){var o=e.filterNode(t,n[i]);o&&r.push(o)}return r}function n(e,t){return t}function r(){}function i(t,n){for(var r="",i=1,s=n.length;i<s;i++)r+=e.compileNode(t,n[i]);return r}function s(t,n,r){return"."+r+"("+e.compileNode(t,n[1])+","+e.compileNode(t,n[2])+","+e.compileNode(t,n[4])+","+e.compileNode(t,n[3])+")"}e.compile=function(t,n){var r,i=e.parse(t);r=e.filterNode({},i),i={name:n,bodies:[],blocks:{},index:0,auto:"h"},r="(function(){dust.register("+(n?'"'+n+'"':"null")+","+e.compileNode(i,r)+");";var s,o=[],u=i.blocks;for(s in u)o.push(s+":"+u[s]);o.length?(i.blocks="ctx=ctx.shiftBlocks(blocks);",s="var blocks={"+o.join(",")+"};"):s=i.blocks="",s=r+s,r=[],o=i.bodies,i=i.blocks,u=0;for(var a=o.length;u<a;u++)r[u]="function body_"+u+"(chk,ctx){"+i+"return chk"+o[u]+";}";return i=r.join(""),s+i+"return body_0;})();"},e.filterNode=function(t,n){return e.optimizers[n[0]](t,n)},e.optimizers={body:function(t,n){for(var r=[n[0]],i,s=1,o=n.length;s<o;s++){var u=e.filterNode(t,n[s]);u&&(u[0]==="buffer"?i?i[1]+=u[1]:(i=u,r.push(u)):(i=null,r.push(u)))}return r},buffer:n,special:function(e,t){return["buffer",o[t[1]]]},format:r,reference:t,"#":t,"?":t,"^":t,"<":t,"+":t,"@":t,"%":t,partial:t,context:t,params:t,bodies:t,param:t,filters:n,key:n,path:n,literal:n,comment:r},e.pragmas={esc:function(e,t,n){var r=e.auto;return t||(t="h"),e.auto=t==="s"?"":t,t=i(e,n.block),e.auto=r,t}};var o={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};e.compileNode=function(t,n){return e.nodes[n[0]](t,n)},e.nodes={body:function(e,t){var n=e.index++,r="body_"+n;return e.bodies[n]=i(e,t),r},buffer:function(e,t){return".write("+u(t[1])+")"},format:function(e,t){return".write("+u(t[1]+t[2])+")"},reference:function(t,n){return".reference("+e.compileNode(t,n[1])+",ctx,"+e.compileNode(t,n[2])+")"},"#":function(e,t){return s(e,t,"section")},"?":function(e,t){return s(e,t,"exists")},"^":function(e,t){return s(e,t,"notexists")},"<":function(t,n){for(var r=n[4],i=1,s=r.length;i<s;i++){var o=r[i];if(o[1][1]==="block"){t.blocks[n[1].text]=e.compileNode(t,o[2]);break}}return""},"+":function(t,n){return".block(ctx.getBlock("+u(n[1].text)+"),"+e.compileNode(t,n[2])+","+e.compileNode(t,n[4])+","+e.compileNode(t,n[3])+")"},"@":function(t,n){return".helper("+u(n[1].text)+","+e.compileNode(t,n[2])+","+e.compileNode(t,n[4])+","+e.compileNode(t,n[3])+")"},"%":function(t,n){var r=n[1][1];if(!e.pragmas[r])return"";for(var i=n[4],s={},o=1,u=i.length;o<u;o++){var a=i[o];s[a[1][1]]=a[2]}i=n[3],a={},o=1;for(u=i.length;o<u;o++){var f=i[o];a[f[1][1]]=f[2][1]}return e.pragmas[r](t,n[2][1]?n[2][1].text:null,s,a)},partial:function(t,n){return".partial("+e.compileNode(t,n[1])+","+e.compileNode(t,n[2])+")"},context:function(t,n){return n[1]?"ctx.rebase("+e.compileNode(t,n[1])+")":"ctx"},params:function(t,n){for(var r=[],i=1,s=n.length;i<s;i++)r.push(e.compileNode(t,n[i]));return r.length?"{"+r.join(",")+"}":"null"},bodies:function(t,n){for(var r=[],i=1,s=n.length;i<s;i++)r.push(e.compileNode(t,n[i]));return"{"+r.join(",")+"}"},param:function(t,n){return e.compileNode(t,n[1])+":"+e.compileNode(t,n[2])},filters:function(e,t){for(var n=[],r=1,i=t.length;r<i;r++)n.push('"'+t[r]+'"');return'"'+e.auto+'"'+(n.length?",["+n.join(",")+"]":"")},key:function(e,t){return'ctx.get("'+t[1]+'")'},path:function(e,t){for(var n=t[1],r=t[2],i=[],s=0,o=r.length;s<o;s++)i.push('"'+r[s]+'"');return"ctx.getPath("+n+",["+i.join(",")+"])"},literal:function(e,t){return u(t[1])}};var u=typeof JSON=="undefined"?function(t){return'"'+e.escapeJs(t)+'"'}:JSON.stringify}(typeof exports!="undefined"?exports:window.dust),function(e){var t=function(){var e={parse:function(e){function t(e){var t=e.charCodeAt(0);if(t<255){e="x";var n=2}else e="u",n=4;e="\\"+e;var r=t.toString(16).toUpperCase();t=r,n-=r.length;for(r=0;r<n;r++)t="0"+t;return e+t}function n(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,t)+'"'}function r(e){A<M||(A>M&&(M=A,_=[]),_.push(e))}function i(){var e="body@"+A,t=D[e];if(t)return A=t.nextPos,t.result;t=[];for(var n=s();n!==null;)t.push(n),n=s();return t=t!==null?["body"].concat(t):null,D[e]={nextPos:A,result:t},t}function s(){var t="part@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=w();if(n!==null)n=n;else{n=o();if(n!==null)n=n;else{n="partial@"+A;var i=D[n];if(i)A=i.nextPos,n=i.result;else{i=O,O=!1;var s=A,u=S();if(u!==null){if(e.substr(A,1)===">"){var a=">";A+=1}else a=null,O&&r('">"');if(a!==null){var l=v();l=l!==null?["literal",l]:null,l!==null?l=l:(l=m(),l=l!==null?l:null);if(l!==null){var p=f();if(p!==null){if(e.substr(A,1)==="/"){var d="/";A+=1}else d=null,O&&r('"/"');if(d!==null){var g=x();g!==null?u=[u,a,l,p,d,g]:(u=null,A=s)}else u=null,A=s}else u=null,A=s}else u=null,A=s}else u=null,A=s}else u=null,A=s;s=u!==null?["partial",u[2],u[3]]:null,(O=i)&&s===null&&r("partial"),D[n]={nextPos:A,result:s},n=s}if(n!==null)n=n;else{n=h();if(n!==null)n=n;else{n=c();if(n!==null)n=n;else{n="buffer@"+A;if(i=D[n])A=i.nextPos,n=i.result;else{i=O,O=!1,s=A,u=T();if(u!==null){a=[];for(l=N();l!==null;)a.push(l),l=N();a!==null?u=[u,a]:(u=null,A=s)}else u=null,A=s;s=u!==null?["format",u[0],u[1].join("")]:null;if(s!==null)s=s;else{l=u=A,a=O,O=!1,p=E(),O=a,p===null?a="":(a=null,A=l),a!==null?(p=A,l=O,O=!1,d=T(),O=l,d===null?l="":(l=null,A=p),l!==null?(p=A,d=O,O=!1,g=w(),O=d,g===null?d="":(d=null,A=p),d!==null?(e.length>A?(p=e.charAt(A),A++):(p=null,O&&r("any character")),p!==null?a=[a,l,d,p]:(a=null,A=u)):(a=null,A=u)):(a=null,A=u)):(a=null,A=u),u=a!==null?a[3]:null;if(u!==null)for(s=[];u!==null;)s.push(u),l=u=A,a=O,O=!1,p=E(),O=a,p===null?a="":(a=null,A=l),a!==null?(p=A,l=O,O=!1,d=T(),O=l,d===null?l="":(l=null,A=p),l!==null?(p=A,d=O,O=!1,g=w(),O=d,g===null?d="":(d=null,A=p),d!==null?(e.length>A?(p=e.charAt(A),A++):(p=null,O&&r("any character")),p!==null?a=[a,l,d,p]:(a=null,A=u)):(a=null,A=u)):(a=null,A=u)):(a=null,A=u),u=a!==null?a[3]:null;else s=null;s=s!==null?["buffer",s.join("")]:null,s=s!==null?s:null}(O=i)&&s===null&&r("buffer"),D[n]={nextPos:A,result:s},n=s}n=n!==null?n:null}}}}}return D[t]={nextPos:A,result:n},n}function o(){var t="section@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=O,O=!1;var s=A,o=u();if(o!==null){var f=x();if(f!==null){var c=i();if(c!==null){var h=l();if(h!==null){var p=a();if(p!==null){var d=o[1].text===p.text?"":null;d!==null?o=[o,f,c,h,p,d]:(o=null,A=s)}else o=null,A=s}else o=null,A=s}else o=null,A=s}else o=null,A=s}else o=null,A=s;return s=o!==null?function(e,t,n){return n.push(["param",["literal","block"],t]),e.push(n),e}(o[0],o[2],o[3],o[4]):null,s!==null?s=s:(s=A,o=u(),o!==null?(e.substr(A,1)==="/"?(f="/",A+=1):(f=null,O&&r('"/"')),f!==null?(c=x(),c!==null?o=[o,f,c]:(o=null,A=s)):(o=null,A=s)):(o=null,A=s),s=o!==null?function(e){return e.push(["bodies"]),e}(o[0]):null,s=s!==null?s:null),(O=n)&&s===null&&r("section"),D[t]={nextPos:A,result:s},s}function u(){var t="sec_tag_start@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=A;var i=S();if(i!==null){if(e.substr(A).match(/^[#?^<+@%]/)!==null){var s=e.charAt(A);A++}else s=null,O&&r("[#?^<+@%]");if(s!==null){var o=p();if(o!==null){var u=f();if(u!==null){var a;a="params@"+A;var l=D[a];if(l)A=l.nextPos,a=l.result;else{l=O,O=!1;var c=[],h=A,d=N();if(d!==null){var g=v();if(g!==null){if(e.substr(A,1)==="="){var y="=";A+=1}else y=null,O&&r('"="');if(y!==null){var b=p();b!==null?b=b:(b=m(),b=b!==null?b:null),b!==null?d=[d,g,y,b]:(d=null,A=h)}else d=null,A=h}else d=null,A=h}else d=null,A=h;for(h=d!==null?["param",["literal",d[1]],d[3]]:null;h!==null;)c.push(h),h=A,d=N(),d!==null?(g=v(),g!==null?(e.substr(A,1)==="="?(y="=",A+=1):(y=null,O&&r('"="')),y!==null?(b=p(),b!==null?b=b:(b=m(),b=b!==null?b:null),b!==null?d=[d,g,y,b]:(d=null,A=h)):(d=null,A=h)):(d=null,A=h)):(d=null,A=h),h=d!==null?["param",["literal",d[1]],d[3]]:null;c=c!==null?["params"].concat(c):null,(O=l)&&c===null&&r("params"),D[a]={nextPos:A,result:c},a=c}a!==null?i=[i,s,o,u,a]:(i=null,A=n)}else i=null,A=n}else i=null,A=n}else i=null,A=n}else i=null,A=n;return n=i!==null?[i[1],i[2],i[3],i[4]]:null,D[t]={nextPos:A,result:n},n}function a(){var t="end_tag@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=O,O=!1;var i=A,s=S();if(s!==null){if(e.substr(A,1)==="/"){var o="/";A+=1}else o=null,O&&r('"/"');if(o!==null){var u=p();if(u!==null){var a=x();a!==null?s=[s,o,u,a]:(s=null,A=i)}else s=null,A=i}else s=null,A=i}else s=null,A=i;return i=s!==null?s[2]:null,(O=n)&&i===null&&r("end tag"),D[t]={nextPos:A,result:i},i}function f(){var t="context@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=A;if(e.substr(A,1)===":"){var i=":";A+=1}else i=null,O&&r('":"');if(i!==null){var s=p();s!==null?i=[i,s]:(i=null,A=n)}else i=null,A=n;return n=i!==null?i[1]:null,n=n!==null?n:"",n=n!==null?n?["context",n]:["context"]:null,D[t]={nextPos:A,result:n},n}function l(){var t="bodies@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=O,O=!1;var s=[],o=A,u=S();if(u!==null){if(e.substr(A,1)===":"){var a=":";A+=1}else a=null,O&&r('":"');if(a!==null){var f=v();if(f!==null){var l=x();if(l!==null){var c=i();c!==null?u=[u,a,f,l,c]:(u=null,A=o)}else u=null,A=o}else u=null,A=o}else u=null,A=o}else u=null,A=o;for(o=u!==null?["param",["literal",u[2]],u[4]]:null;o!==null;)s.push(o),o=A,u=S(),u!==null?(e.substr(A,1)===":"?(a=":",A+=1):(a=null,O&&r('":"')),a!==null?(f=v(),f!==null?(l=x(),l!==null?(c=i(),c!==null?u=[u,a,f,l,c]:(u=null,A=o)):(u=null,A=o)):(u=null,A=o)):(u=null,A=o)):(u=null,A=o),o=u!==null?["param",["literal",u[2]],u[4]]:null;return s=s!==null?["bodies"].concat(s):null,(O=n)&&s===null&&r("bodies"),D[t]={nextPos:A,result:s},s}function c(){var t="reference@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=O,O=!1;var i=A,s=S();if(s!==null){var o=p();if(o!==null){var u;u="filters@"+A;var a=D[u];if(a)A=a.nextPos,u=a.result;else{a=O,O=!1;var f=[],l=A;if(e.substr(A,1)==="|"){var c="|";A+=1}else c=null,O&&r('"|"');if(c!==null){var h=v();h!==null?c=[c,h]:(c=null,A=l)}else c=null,A=l;for(l=c!==null?c[1]:null;l!==null;)f.push(l),l=A,e.substr(A,1)==="|"?(c="|",A+=1):(c=null,O&&r('"|"')),c!==null?(h=v(),h!==null?c=[c,h]:(c=null,A=l)):(c=null,A=l),l=c!==null?c[1]:null;f=f!==null?["filters"].concat(f):null,(O=a)&&f===null&&r("filters"),D[u]={nextPos:A,result:f},u=f}u!==null?(a=x(),a!==null?s=[s,o,u,a]:(s=null,A=i)):(s=null,A=i)}else s=null,A=i}else s=null,A=i;return i=s!==null?["reference",s[1],s[2]]:null,(O=n)&&i===null&&r("reference"),D[t]={nextPos:A,result:i},i}function h(){var t="special@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=O,O=!1;var i=A,s=S();if(s!==null){if(e.substr(A,1)==="~"){var o="~";A+=1}else o=null,O&&r('"~"');if(o!==null){var u=v();if(u!==null){var a=x();a!==null?s=[s,o,u,a]:(s=null,A=i)}else s=null,A=i}else s=null,A=i}else s=null,A=i;return i=s!==null?["special",s[2]]:null,(O=n)&&i===null&&r("special"),D[t]={nextPos:A,result:i},i}function p(){var e="identifier@"+A,t=D[e];if(t)return A=t.nextPos,t.result;t=O,O=!1;var n=d();return n=n!==null?L(["path"].concat(n),e):null,n!==null?n=n:(n=v(),n=n!==null?L(["key",n],e):null,n=n!==null?n:null),(O=t)&&n===null&&r("identifier"),D[e]={nextPos:A,result:n},n}function d(){var t="path@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=O,O=!1;var i=A,s=v();s=s!==null?s:"";if(s!==null){var o=A;if(e.substr(A,1)==="."){var u=".";A+=1}else u=null,O&&r('"."');if(u!==null){var a=v();a!==null?u=[u,a]:(u=null,A=o)}else u=null,A=o;o=u!==null?u[1]:null;if(o!==null)for(var f=[];o!==null;)f.push(o),o=A,e.substr(A,1)==="."?(u=".",A+=1):(u=null,O&&r('"."')),u!==null?(a=v(),a!==null?u=[u,a]:(u=null,A=o)):(u=null,A=o),o=u!==null?u[1]:null;else f=null;f!==null?s=[s,f]:(s=null,A=i)}else s=null,A=i;return i=s!==null?function(e,t){return e?(t.unshift(e),[!1,t]):[!0,t]}(s[0],s[1]):null,i!==null?i=i:(e.substr(A,1)==="."?(i=".",A+=1):(i=null,O&&r('"."')),i=i!==null?[!0,[]]:null,i=i!==null?i:null),(O=n)&&i===null&&r("path"),D[t]={nextPos:A,result:i},i}function v(){var t="key@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=O,O=!1;var i=A;if(e.substr(A).match(/^[a-zA-Z_$]/)!==null){var s=e.charAt(A);A++}else s=null,O&&r("[a-zA-Z_$]");if(s!==null){var o=[];if(e.substr(A).match(/^[0-9a-zA-Z_$]/)!==null){var u=e.charAt(A);A++}else u=null,O&&r("[0-9a-zA-Z_$]");for(;u!==null;)o.push(u),e.substr(A).match(/^[0-9a-zA-Z_$]/)!==null?(u=e.charAt(A),A++):(u=null,O&&r("[0-9a-zA-Z_$]"));o!==null?s=[s,o]:(s=null,A=i)}else s=null,A=i;return i=s!==null?s[0]+s[1].join(""):null,(O=n)&&i===null&&r("key"),D[t]={nextPos:A,result:i},i}function m(){var t="inline@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=O,O=!1;var i=A;if(e.substr(A,1)==='"'){var s='"';A+=1}else s=null,O&&r('"\\""');if(s!==null){if(e.substr(A,1)==='"'){var o='"';A+=1}else o=null,O&&r('"\\""');o!==null?s=[s,o]:(s=null,A=i)}else s=null,A=i;i=s!==null?["literal",""]:null;if(i!==null)i=i;else{i=A,e.substr(A,1)==='"'?(s='"',A+=1):(s=null,O&&r('"\\""'));if(s!==null){o=y();if(o!==null){if(e.substr(A,1)==='"'){var u='"';A+=1}else u=null,O&&r('"\\""');u!==null?s=[s,o,u]:(s=null,A=i)}else s=null,A=i}else s=null,A=i;i=s!==null?["literal",s[1]]:null;if(i!==null)i=i;else{i=A,e.substr(A,1)==='"'?(s='"',A+=1):(s=null,O&&r('"\\""'));if(s!==null){u=g();if(u!==null)for(o=[];u!==null;)o.push(u),u=g();else o=null;o!==null?(e.substr(A,1)==='"'?(u='"',A+=1):(u=null,O&&r('"\\""')),u!==null?s=[s,o,u]:(s=null,A=i)):(s=null,A=i)}else s=null,A=i;i=s!==null?["body"].concat(s[1]):null,i=i!==null?i:null}}return(O=n)&&i===null&&r("inline"),D[t]={nextPos:A,result:i},i}function g(){var e="inline_part@"+A,t=D[e];return t?(A=t.nextPos,t.result):(t=h(),t!==null?t=t:(t=c(),t!==null?t=t:(t=y(),t=t!==null?["buffer",t]:null,t=t!==null?t:null)),D[e]={nextPos:A,result:t},t)}function y(){var t="literal@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=O,O=!1;var i=A,s=A,o=O;O=!1;var u=E();O=o,u===null?o="":(o=null,A=s);if(o!==null){u=A,s=O,O=!1;var a=T();O=s,a===null?s="":(s=null,A=u),s!==null?(u=b(),u!==null?u=u:(e.substr(A).match(/^[^"]/)!==null?(u=e.charAt(A),A++):(u=null,O&&r('[^"]')),u=u!==null?u:null),u!==null?o=[o,s,u]:(o=null,A=i)):(o=null,A=i)}else o=null,A=i;i=o!==null?o[2]:null;if(i!==null)for(var f=[];i!==null;)f.push(i),s=i=A,o=O,O=!1,u=E(),O=o,u===null?o="":(o=null,A=s),o!==null?(u=A,s=O,O=!1,a=T(),O=s,a===null?s="":(s=null,A=u),s!==null?(u=b(),u!==null?u=u:(e.substr(A).match(/^[^"]/)!==null?(u=e.charAt(A),A++):(u=null,O&&r('[^"]')),u=u!==null?u:null),u!==null?o=[o,s,u]:(o=null,A=i)):(o=null,A=i)):(o=null,A=i),i=o!==null?o[2]:null;else f=null;return f=f!==null?f.join(""):null,(O=n)&&f===null&&r("literal"),D[t]={nextPos:A,result:f},f}function b(){var t="esc@"+A,n=D[t];return n?(A=n.nextPos,n.result):(e.substr(A,2)==='\\"'?(n='\\"',A+=2):(n=null,O&&r('"\\\\\\""')),n=n!==null?'"':null,D[t]={nextPos:A,result:n},n)}function w(){var t="comment@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=O,O=!1;var i=A;if(e.substr(A,2)==="{!"){var s="{!";A+=2}else s=null,O&&r('"{!"');if(s!==null){var o=[],u=A,a=A,f=O;O=!1;if(e.substr(A,2)==="!}"){var l="!}";A+=2}else l=null,O&&r('"!}"');O=f,l===null?f="":(f=null,A=a),f!==null?(e.length>A?(a=e.charAt(A),A++):(a=null,O&&r("any character")),a!==null?a=[f,a]:(a=null,A=u)):(a=null,A=u);for(u=a!==null?a[1]:null;u!==null;)o.push(u),a=u=A,f=O,O=!1,e.substr(A,2)==="!}"?(l="!}",A+=2):(l=null,O&&r('"!}"')),O=f,l===null?f="":(f=null,A=a),f!==null?(e.length>A?(a=e.charAt(A),A++):(a=null,O&&r("any character")),a!==null?a=[f,a]:(a=null,A=u)):(a=null,A=u),u=a!==null?a[1]:null;o!==null?(e.substr(A,2)==="!}"?(u="!}",A+=2):(u=null,O&&r('"!}"')),u!==null?s=[s,o,u]:(s=null,A=i)):(s=null,A=i)}else s=null,A=i;return i=s!==null?["comment",s[1].join("")]:null,(O=n)&&i===null&&r("comment"),D[t]={nextPos:A,result:i},i}function E(){var t="tag@"+A,n=D[t];if(n)return A=n.nextPos,n.result;n=A;var i=S();if(i!==null){if(e.substr(A).match(/^[#?^><+%:@\/~%]/)!==null){var s=e.charAt(A);A++}else s=null,O&&r("[#?^><+%:@\\/~%]");if(s!==null){var o=A,u=A,a=O;O=!1;var f=x();O=a,f===null?a="":(a=null,A=u);if(a!==null){u=A,f=O,O=!1;var l=T();O=f,l===null?f="":(f=null,A=u),f!==null?(e.length>A?(u=e.charAt(A),A++):(u=null,O&&r("any character")),u!==null?a=[a,f,u]:(a=null,A=o)):(a=null,A=o)}else a=null,A=o;if(a!==null)for(var h=[];a!==null;)h.push(a),u=o=A,a=O,O=!1,f=x(),O=a,f===null?a="":(a=null,A=u),a!==null?(u=A,f=O,O=!1,l=T(),O=f,l===null?f="":(f=null,A=u),f!==null?(e.length>A?(u=e.charAt(A),A++):(u=null,O&&r("any character")),u!==null?a=[a,f,u]:(a=null,A=o)):(a=null,A=o)):(a=null,A=o);else h=null;h!==null?(o=x(),o!==null?i=[i,s,h,o]:(i=null,A=n)):(i=null,A=n)}else i=null,A=n}else i=null,A=n;return i!==null?n=i:(n=c(),n=n!==null?n:null),D[t]={nextPos:A,result:n},n}function S(){var t="ld@"+A,n=D[t];return n?(A=n.nextPos,n.result):(e.substr(A,1)==="{"?(n="{",A+=1):(n=null,O&&r('"{"')),D[t]={nextPos:A,result:n},n)}function x(){var t="rd@"+A,n=D[t];return n?(A=n.nextPos,n.result):(e.substr(A,1)==="}"?(n="}",A+=1):(n=null,O&&r('"}"')),D[t]={nextPos:A,result:n},n)}function T(){var t="eol@"+A,n=D[t];return n?(A=n.nextPos,n.result):(e.substr(A,1)==="\n"?(n="\n",A+=1):(n=null,O&&r('"\\n"')),n!==null?n=n:(e.substr(A,2)==="\r\n"?(n="\r\n",A+=2):(n=null,O&&r('"\\r\\n"')),n!==null?n=n:(e.substr(A,1)==="\r"?(n="\r",A+=1):(n=null,O&&r('"\\r"')),n!==null?n=n:(e.substr(A,1)==="\u2028"?(n="\u2028",A+=1):(n=null,O&&r('"\\u2028"')),n!==null?n=n:(e.substr(A,1)==="\u2029"?(n="\u2029",A+=1):(n=null,O&&r('"\\u2029"')),n=n!==null?n:null)))),D[t]={nextPos:A,result:n},n)}function N(){var t="ws@"+A,n=D[t];return n?(A=n.nextPos,n.result):(e.substr(A).match(/^[\t\u000b\u000c \xA0\uFEFF]/)!==null?(n=e.charAt(A),A++):(n=null,O&&r("[	\f \\xA0\\uFEFF]")),D[t]={nextPos:A,result:n},n)}function C(){var t=function(e){e.sort();for(var t=null,n=[],r=0;r<e.length;r++)e[r]!==t&&(n.push(e[r]),t=e[r]);switch(n.length){case 0:return"end of input";case 1:return n[0];default:return n.slice(0,n.length-1).join(", ")+" or "+n[n.length-1]}}(_),r=Math.max(A,M);return r=r<e.length?n(e.charAt(r)):"end of input","Expected "+t+" but "+r+" found."}function k(){for(var t=1,n=1,r=!1,i=0;i<M;i++){var s=e.charAt(i);s==="\n"?(r||t++,n=1,r=!1):s==="\r"|s==="\u2028"||s==="\u2029"?(t++,n=1,r=!0):(n++,r=!1)}return{line:t,column:n}}function L(t,n){return t.text=e.substring(n.split("@")[1],A),t}var A=0,O=!0,M=0,_=[],D={},P=i();if(P===null||A!==e.length)throw P=k(),new SyntaxError(C(),P.line,P.column);return P},toSource:function(){return this._source}};return e.SyntaxError=function(e,t,n){this.name="SyntaxError",this.message=e,this.line=t,this.column=n},e.SyntaxError.prototype=Error.prototype,e}();e.parse=t.parse}(typeof exports!="undefined"?exports:window.dust),define("dust",function(){}),define("core/mediaManager",[],function(){var e=function(){};return e.EVENT_DELETE_SUCCESS="delete_media_success",e.EVENT_DELETE_ERROR="delete_media_error",e.EVENT_UPDATE_SUCCESS="update_media_success",e.EVENT_UPDATE_ERROR="update_media_error",e.prototype.deleteMedia=function(t,n){var r=this;if(typeof n!="undefined"){var i=confirm(n);if(!i)return!1}var s=Routing.generate("imdc_myfiles_remove",{mediaId:t}),o={mediaId:t};$.ajax({url:s,type:"POST",contentType:"application/x-www-form-urlencoded",data:o,success:function(t){t.responseCode==200?$(r).trigger(e.EVENT_DELETE_SUCCESS):t.responseCode==400?($(r).trigger(e.EVENT_DELETE_ERROR,t.feedback),console.log("Error: "+t.feedback)):($(r).trigger(e.EVENT_DELETE_ERROR,"Unknown Error"),console.log("An unexpected error occured"))},error:function(t){$(r).trigger(e.EVENT_DELETE_ERROR,t),console.log(t)}})},e.prototype.trimMedia=function(e,t,n){var r=this,i=Routing.generate("imdc_myfiles_trim",{mediaId:e,startTime:t,endTime:n}),s={mediaId:e,startTime:t,endTime:n};$.ajax({url:i,type:"POST",contentType:"application/x-www-form-urlencoded",data:s,success:function(e){console.log(e),e.responseCode==200?r.media=e.media:e.responseCode==400?console.log("Error: "+e.feedback):console.log("An unexpected error occured")},error:function(e){console.log(e)}})},e.prototype.updateMedia=function(t){var n=this;typeof t=="undefined"&&($(n).trigger(e.EVENT_UPDATE_ERROR,"Must send a media object"),console.log("Error: Must send a media object"));var r=Routing.generate("imdc_myfiles_update",{mediaId:t.id});console.log(t);var i={mediaId:t.id,media:JSON.stringify(t)};console.log(i),$.ajax({url:r,type:"POST",contentType:"application/x-www-form-urlencoded",data:i,success:function(t){t.responseCode==200?$(n).trigger(e.EVENT_UPDATE_SUCCESS):t.responseCode==400?($(n).trigger(e.EVENT_UPDATE_ERROR,t.feedback),console.log("Error: "+t.feedback)):($(n).trigger(e.EVENT_UPDATE_ERROR,"Unknown Error"),console.log("An unexpected error occured"))},error:function(t){$(n).trigger(e.EVENT_UPDATE_ERROR,t),console.log(t)}})},e}),define("core/mediaChooser",["core/mediaManager"],function(e){var t=function(t){this.element=t.element.dialog({autoOpen:!1}),this.isPopUp=t.isPopUp,this.isFileSelection=typeof t.isFileSelection!="undefined"?t.isFileSelection:!0,this.isPost=typeof t.isPost!="undefined"?t.isPost:!1,this.isNewPost=typeof t.isNewPost!="undefined"?t.isNewPost:!1,this.postId=t.postId,this.postSuffix=this.isPost?"Post"+this.postId:"",this.recorder=null,this.player=null,this.mediaManager=new e,this.media=null,this.bind__onRecordingSuccess=this._onRecordingSuccess.bind(this),this.bind__onRecordingError=this._onRecordingError.bind(this),this.bind__previewVideoForwardFunctionCut=this._previewVideoForwardFunctionCut.bind(this),this.bind__previewVideoForwardFunctionDone=this._previewVideoForwardFunctionDone.bind(this),this.bind__previewVideoForwardFunctionDoneAndPost=this._previewVideoForwardFunctionDoneAndPost.bind(this),this.bind__previewVideoBackFunction=this._previewVideoBackFunction.bind(this)};return t.TAG="MediaChooser",t.Event={SUCCESS:"success",SUCCESS_AND_POST:"successAndPost",ERROR:"error",RESET:"reset",DIALOG_CLOSE:"dialogClose"},t.MEDIA_TYPES=["audio","video","image","other"],t.TYPE_ALL=0,t.TYPE_UPLOAD_AUDIO=1,t.TYPE_UPLOAD_IMAGE=2,t.TYPE_UPLOAD_OTHER=3,t.TYPE_RECORD_VIDEO=4,t.TYPE_RECORD_AUDIO=5,t.TYPE_UPLOAD_VIDEO=6,t.DIALOG_TITLE_SELECT="Select from My Files",t.DIALOG_TITLE_PREVIEW="Preview",t.DIALOG_RECORD_VIDEO="Record a new video",t.DIALOG_RECORD_AUDIO="Record a new audio",t.prototype.bindUIEvents=function(){console.log("%s: %s",t.TAG,"bindUIEvents");if(this.isPost){this._bindUIEventsPost();return}$("#recordVideo").on("click",function(e){e.preventDefault(),this.chooseFile({type:t.TYPE_RECORD_VIDEO})}.bind(this)),this._bindUIEventsUploadFile($("#uploadForms"),$("#uploadFile")),$("#selectFile").on("click",function(e){e.preventDefault(),this.chooseFile({})}.bind(this)),$("#removeFile").on("click",function(e){e.preventDefault(),this._invokeReset()}.bind(this))},t.prototype._bindUIEventsPost=function(){console.log("%s: %s",t.TAG,"_bindUIEventsPost"),$("#recordVideoPost"+this.postId).on("click",function(e){e.preventDefault(),this.chooseFile({type:t.TYPE_RECORD_VIDEO})}.bind(this)),$("#selectFilePost"+this.postId).on("click",function(e){e.preventDefault(),this.chooseFile({})}.bind(this)),this._bindUIEventsUploadFile($("#uploadFormsPost"+this.postId),$("#uploadFilePost"+this.postId)),$("#removeFilePost"+this.postId).on("click",function(e){e.preventDefault(),this._invokeReset()}.bind(this))},t.prototype._bindUIEventsUploadFile=function(e,n){console.log("%s: %s",t.TAG,"_bindUIEventsUploadFile"),$.each(t.MEDIA_TYPES,function(n,r){var i=e.find("#imdc_terptube_"+r+"_media_resource_file"),s=e.find("#imdc_terptube_"+r+"_media_title"),o=e.find("form[name=imdc_terptube_"+r+"_media]");i.on("change",function(e){if(i.val()=="")return;s.val(t._cleanFileNameNoExt(i.val())),$("#uploadingFileTitle"+this.postSuffix).html(s.val()),$("#chooseFile"+this.postSuffix).hide(),this.loadNextPage({url:Routing.generate("imdc_myfiles_add_"+r),method:"POST",data:new FormData(o[0]),uploadProgress:!0}),i.val(""),s.val("")}.bind(this))}.bind(this)),$.each(t.MEDIA_TYPES,function(t,r){var i=n.find("#upload-"+r+"-link"),s=e.find("#imdc_terptube_"+r+"_media_resource_file");i.on("click",function(e){e.preventDefault(),s.click()})})},t.prototype.bindUIEventsSelectFromMyFiles=function(){console.log("%s: %s",t.TAG,"bindUIEventsSelectFromMyFiles"),$(".preview-button").on("click",function(e){e.preventDefault();if($(e.target).hasClass("disabled"))return!1;$("#preview").html(""),this.previewMedia({mediaUrl:$(e.target).data("url"),mediaId:$(e.target).data("val")})}.bind(this)),$(".select-button").on("click",function(e){e.preventDefault(),this.setMedia({id:$(e.target).data("val"),title:$(e.target).data("title")}),this._invokeSuccess(),this._terminatingFunction()}.bind(this))},t._dialogTitleForType=function(e){console.log("%s: %s",t.TAG,"_dialogTitleForType");switch(e){case t.TYPE_ALL:return t.DIALOG_TITLE_SELECT;case t.TYPE_RECORD_VIDEO:return t.DIALOG_RECORD_VIDEO;case t.TYPE_RECORD_AUDIO:return t.DIALOG_RECORD_AUDIO;case t.TYPE_UPLOAD_AUDIO:case t.TYPE_UPLOAD_IMAGE:case t.TYPE_UPLOAD_OTHER:case t.TYPE_UPLOAD_VIDEO:default:return t.DIALOG_TITLE_PREVIEW}},t._cleanFileNameNoExt=function(e){return e=e.split(/(\\|\/)/g).pop(),(e.substr(0,e.lastIndexOf("."))||e).replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"-")},t.prototype.createVideoRecorder=function(e){console.log("%s: %s",t.TAG,"createVideoRecorder"),this.recorder=new Player(e.videoElement,{areaSelectionEnabled:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,type:Player.DENSITY_BAR_TYPE_RECORDER,audioBar:!1,volumeControl:!1,recordingSuccessFunction:this.bind__onRecordingSuccess,recordingErrorFunction:this.bind__onRecordingError,recordingPostURL:Routing.generate("imdc_myfiles_add_recording"),forwardButtons:e.forwardButtons,forwardFunctions:e.forwardFunctions}),$(this.recorder).on(Player.EVENT_RECORDING_UPLOAD_PROGRESS,function(e,n){t._updateUploadProgress($("#recordVideoUploadProgress"),n)}),$(this.recorder).on(Player.EVENT_RECORDING_UPLOADED,function(e){$("#recordVideoUploadProgress").hide()}),this.recorder.createControls(),e.videoElement.parents(".ui-dialog").on("dialogbeforeclose",function(e,t){console.log("videoElement dialogbeforeclose"),this.recorder!=null&&this.recorder.destroyRecorder()}.bind(this))},t.prototype._onRecordingSuccess=function(e){console.log("%s: %s- mediaId=%d",t.TAG,"_onRecordingSuccess",e.media.id),this.setMedia(e.media)},t.prototype._onRecordingError=function(e){console.log("%s: %s- e=%s",t.TAG,"_onRecordingError",e)},t.prototype.destroyVideoRecorder=function(){console.log("%s: %s",t.TAG,"destroyVideoRecorder"),this.recorder.destroyRecorder()},t.prototype._onUploadProgress=function(e){console.log("%s: %s- percentComplete=%d",t.TAG,"_onUploadProgress",e),t._updateUploadProgress($("#uploadProgress"+this.postSuffix),e)},t._updateUploadProgress=function(e,t){var n=e.find(".progress-bar");e.show(),n.attr("aria-valuenow",t),n.css("width",t+"%"),n.html(t+"%")},t.prototype.chooseFile=function(e){console.log("%s: %s",t.TAG,"chooseFile");var n=typeof e.type=="undefined"?t.TYPE_ALL:e.type;this.isPopUp?this._popUp(n,function(){this._loadChooserPage(n,e.data)}):this._loadChooserPage(n,e.data)},t.prototype._loadChooserPage=function(e,n){console.log("%s: %s",t.TAG,"_loadChooserPage");var r={url:Routing.generate("imdc_media_chooser_by_type",{type:e}),type:"POST",contentType:"application/x-www-form-urlencoded",processData:!0,success:function(e){console.log("%s: %s: %s",t.TAG,"_loadChooserPage","success"),this.element.html(e.page)}.bind(this),error:function(e){console.log("%s: %s: %s",t.TAG,"_loadChooserPage","error"),console.log(e.statusText)}};n=typeof n=="undefined"?{type:e}:n,n.type=typeof n.type=="undefined"?e:n.type,n.isPost=this.isPost?1:0,r.data=n,$.ajax(r)},t.prototype.previewMedia=function(e){console.log("%s: %s",t.TAG,"previewMedia"),this.recording=e.recording,this.isPopUp&&!this.element.dialog("isOpen")?this._popUp(e.type,function(){this._loadMediaPage(e.mediaUrl,e.mediaId)}):(this.element.dialog("option","title",t._dialogTitleForType(e.type)),this._loadMediaPage(e.mediaUrl,e.mediaId))},t.prototype._loadMediaPage=function(e,n){console.log("%s: %s",t.TAG,"_loadMediaPage"),this.loadNextPage({url:e,method:"POST",data:{mediaId:n},preview:!0,isPost:this.isPost?1:0})},t.prototype.loadNextPage=function(e){console.log("%s: %s",t.TAG,"loadNextPage");var n={url:e.url,data:e.data,success:function(n,r,i){console.log("%s: %s: %s- finished=%s",t.TAG,"loadNextPage","success",n.finished),this.setMedia(n.media),typeof n.finished!="undefined"&&n.finished===!0?(this.media!=null&&this._invokeSuccess(),this._terminatingFunction()):(this.element.html(n.page),e.preview&&$("#preview-media-title").blur(function(e){console.log("updated title"),this.media.title=$("#preview-media-title").val(),this.mediaManager.updateMedia(this.media)}.bind(this)))}.bind(this),error:function(e,n,r){console.log("%s: %s: %s",t.TAG,"loadNextPage","error"),this._invokeError(e)}.bind(this)};n.type=typeof e.method=="undefined"?"GET":e.method,e.method!="GET"&&(n.processData=!1,n.contentType=!1),e.uploadProgress&&(n.xhr=function(){var e=$.ajaxSettings.xhr();return e.upload.addEventListener("progress",function(e){if(!e.lengthComputable)return;this._onUploadProgress(Math.floor(e.loaded/e.total*100))}.bind(this),!1),e}.bind(this)),$.ajax(n)},t.prototype._popUp=function(e,n){console.log("%s: %s",t.TAG,"_popUp"),this.element.dialog({autoOpen:!1,resizable:!1,modal:!0,draggable:!1,closeOnEscape:!0,dialogClass:"tt-popup-dialog",open:function(e,r){console.log("%s: %s: %s",t.TAG,"_popUp","open"),n.call(this)}.bind(this),create:function(e,n){console.log("%s: %s: %s",t.TAG,"_popUp","create")},close:function(e,n){console.log("%s: %s: %s",t.TAG,"_popUp","close"),this.element.html(""),this._terminatingFunction()}.bind(this),show:"blind",hide:"blind",minWidth:740,position:{at:"top",my:"top"},title:t._dialogTitleForType(e)}),this.element.dialog("open")},t.prototype.previewVideo=function(){console.log("%s: %s",t.TAG,"previewVideo");var e=["<button class='cutButton'></button>","<button class='doneButton'></button>"],n=[this.bind__previewVideoForwardFunctionCut,this.bind__previewVideoForwardFunctionDone];console.log("isPost: %s postID: %s",this.isPost,this.postId);if(this.isPost||this.isNewPost)e=["<button class='cutButton'></button>","<button class='doneButton'></button>","<button class='doneAndPostButton'></button>"],n=[this.bind__previewVideoForwardFunctionCut,this.bind__previewVideoForwardFunctionDone,this.bind__previewVideoForwardFunctionDoneAndPost];var r,i;typeof this.recording!="undefined"&&this.recording&&(r=["<button class='backButton'></button>"],i=[this.bind__previewVideoBackFunction]),this.player=new Player($("#"+this.media.id),{areaSelectionEnabled:!0,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_RELATIVE,forwardButtons:e,forwardFunctions:n,backButtons:r,backFunctions:i,selectedRegionColor:"#0000ff"}),this.player.createControls()},t.prototype._previewVideoBackFunction=function(e){console.log("%s: %s",t.TAG,"_previewVideoBackFunction"),this.mediaManager.deleteMedia(this.media.id),this.element.html(""),this.media=null,this._loadChooserPage(t.TYPE_RECORD_VIDEO)},t.prototype._previewVideoForwardFunctionCut=function(e){console.log("%s: %s",t.TAG,"_previewVideoForwardFunctionCut");var n=this.player.getCurrentMinMaxTime(),r=this.player.getAreaSelectionTimes();this.player.setCurrentMinMaxTime(r.minTime,r.maxTime),console.log("Current Min/Max Times %s %s",r.minTime,r.maxTime),console.log("Cutting to Min/Max Times %s %s",r.minTime-n.minTime,r.maxTime-n.minTime),this.mediaManager.trimMedia(this.media.id,r.minTime-n.minTime,r.maxTime-n.minTime)},t.prototype._previewVideoForwardFunctionDone=function(e){console.log("%s: %s",t.TAG,"_previewVideoForwardFunctionDone"),this.media!=null&&this._invokeSuccess(),this._terminatingFunction()},t.prototype._previewVideoForwardFunctionDoneAndPost=function(e){console.log("%s: %s",t.TAG,"_previewVideoForwardFunctionDoneAndPost"),this.media!=null&&this._invokeSuccess(!0),this._terminatingFunction()},t.prototype._terminatingFunction=function(){console.log("%s: %s",t.TAG,"_terminatingFunction"),this.element.dialog("isOpen")&&(this.element.off("dialogclose"),this.element.dialog("close")),$(this).trigger($.Event(t.Event.DIALOG_CLOSE,{media:this.media}))},t.prototype._invokeSuccess=function(e){console.log("%s: %s",t.TAG,"_invokeSuccess");var n={media:this.media,postId:this.postId};$("#uploadingFileTitle"+this.postSuffix).html(""),$("#uploadProgress"+this.postSuffix).hide(),this.isFileSelection?($("#chooseFile"+this.postSuffix).hide(),$("#selectedFileTitle"+this.postSuffix).html(this.media.title),$("#selectedFile"+this.postSuffix).show()):$("#chooseFile"+this.postSuffix).show(),typeof e!="undefined"&&e==1?$(this).trigger($.Event(t.Event.SUCCESS_AND_POST,n)):$(this).trigger($.Event(t.Event.SUCCESS,n))},t.prototype._invokeError=function(e){console.log("%s: %s- jqXHR=%o",t.TAG,"_invokeError",e),$("#uploadingFileTitle"+this.postSuffix).html(""),$("#uploadProgress"+this.postSuffix).hide(),$("#chooseFile"+this.postSuffix).show(),this.isFileSelection&&($("#selectedFile"+this.postSuffix).hide(),$("#selectedFileTitle"+this.postSuffix).html("")),$(this).trigger($.Event(t.Event.ERROR,{jqXHR:e}))},t.prototype._invokeReset=function(){console.log("%s: %s",t.TAG,"_invokeReset"),$("#uploadingFileTitle"+this.postSuffix).html(""),$("#uploadProgress"+this.postSuffix).hide(),$("#chooseFile"+this.postSuffix).show(),this.isFileSelection&&($("#selectedFile"+this.postSuffix).hide(),$("#selectedFileTitle"+this.postSuffix).html("")),this.setMedia(null),$(this).trigger($.Event(t.Event.RESET,{postId:this.postId}))},t.prototype.setMedia=function(e){console.log("%s: %s",t.TAG,"setMedia"),this.media=typeof e!="undefined"?e:this.media},t}),define("controller/myFiles",["core/mediaChooser","core/mediaManager"],function(e,t){var n=function(){this.page=null,this.mediaChooser=null,this.mediaManager=new t,this.forwardButton="<button class='forwardButton'></button>",this.bind__onPreviewButtonClick=this.onPreviewButtonClick.bind(this),this.bind__onDeleteButtonClick=this.onDeleteButtonClick.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onDialogClose=this._onDialogClose.bind(this),this.bind_forwardFunction=this.forwardFunction.bind(this),dust.compileFn($("#mediaRow").html(),"mediaRow")};return n.TAG="MyFiles",n.Page={INDEX:0,PREVIEW:1},n.mediaChooserOptions=function(e){switch(e){case n.Page.INDEX:return{element:$("#preview"),isPopUp:!0,isFileSelection:!1};case n.Page.PREVIEW:return{}}},n.prototype.bindUIEvents=function(e){console.log("%s: %s- page=%d",n.TAG,"bindUIEvents",e),this.page=e;switch(this.page){case n.Page.INDEX:this._bindUIEventsIndex();break;case n.Page.PREVIEW:}},n.prototype._bindUIEventsIndex=function(){console.log("%s: %s",n.TAG,"_bindUIEventsIndex"),this.mediaChooser=new e(n.mediaChooserOptions(n.Page.INDEX)),$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.DIALOG_CLOSE,this.bind__onDialogClose),this.mediaChooser.bindUIEvents(),$(".preview-button").on("click",this.bind__onPreviewButtonClick),$(".delete-button").on("click",this.bind__onDeleteButtonClick)},n.prototype.onPreviewButtonClick=function(e){e.preventDefault(),console.log("Preview");if($(e.target).hasClass("disabled"))return!1;$("#preview").html(""),this.page=n.Page.PREVIEW,this.mediaChooser.previewMedia({mediaUrl:$(e.target).data("url"),mediaId:$(e.target).data("val")})},n.prototype.onDeleteButtonClick=function(e){e.preventDefault();var n=$(e.target);return $(this.mediaManager).one(t.EVENT_DELETE_SUCCESS,function(){n.parent().parent().parent().remove()}),$(this.mediaManager).one(t.EVENT_DELETE_ERROR,function(e,t){t.status==500?alert(t.statusText):alert("Error: "+e)}),this.mediaManager.deleteMedia(n.data("val"),$("#mediaDeleteConfirmMessage").html())},n.prototype._onSuccess=function(e){switch(this.page){case n.Page.INDEX:this._addMediaRow(e.media);break;case n.Page.PREVIEW:console.log("Done previewing")}},n.prototype._onDialogClose=function(e){switch(this.page){case n.Page.PREVIEW:this.page=n.Page.INDEX,console.log("Terminating function called"),console.log(e.media),this._updateMediaRow(e.media)}},n.prototype.createVideoRecorder=function(e){console.log("%s: %s",n.TAG,"createVideoRecorder"),this.mediaChooser.createVideoRecorder({videoElement:e,forwardButtons:[this.forwardButton],forwardFunctions:[this.bind_forwardFunction]})},n.prototype.forwardFunction=function(){console.log("%s: %s",n.TAG,"forwardFunction"),this.mediaChooser.destroyVideoRecorder(),this.mediaChooser.previewMedia({type:e.TYPE_RECORD_VIDEO,mediaUrl:Routing.generate("imdc_myfiles_preview",{mediaId:this.mediaChooser.media.id}),mediaId:this.mediaChooser.media.id,recording:!0})},n.prototype._addMediaRow=function(e){console.log("%s: %s",n.TAG,"_addMediaRow");var t={media:e};e.isReady==0&&(t.previewDisabled=!0);switch(e.type){case 0:t.icon="fa-picture-o",t.mediaType="Image";break;case 1:t.icon="fa-film",t.mediaType="Video",t.canInterpret=!0;break;case 2:t.icon="fa-headphones",t.mediaType="Audio",t.canInterpret=!0;break;default:t.icon="fa-film",t.mediaType="Other"}var r=new Date(e.metaData.timeUploaded.date),i=r.getHours()>=12?"pm":"am",s=r.getHours()>12?r.getHours()-12:r.getHours();s=s<10?"0"+s:s;var o=s+":"+(r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes())+i,u=o+" "+$.datepicker.formatDate("M d",r);t.dateString=u,e.metaData.size>0&&(t.mediaSize=(e.metaData.size/1024/1024).toFixed(2));var a=this;t.deleteUrl=Routing.generate("imdc_myfiles_remove",{mediaId:e.id}),t.previewUrl=Routing.generate("imdc_myfiles_preview",{mediaId:e.id}),t.newThreadUrl=Routing.generate("imdc_thread_new_from_media",{resourceid:e.id}),t.simulRecordUrl=Routing.generate("imdc_media_simultaneous_record",{mediaID:e.id}),dust.render("mediaRow",t,function(e,t){$(".tt-myFiles-table").append(t)}),$(".preview-button:last").on("click",this.bind__onPreviewButtonClick),$(".delete-button:last").on("click",this.bind__onDeleteButtonClick)},n.prototype._updateMediaRow=function(e){console.log("%s: %s",n.TAG,"_updateMediaRow");var t={media:e};e.metaData.size>0&&(t.mediaSize=(e.metaData.size/1024/1024).toFixed(2)+" MB"),t.title=e.title;var r=$("a[data-val|="+t.media.id+"]").eq(0).parents("tr").eq(0);console.log(r),r.children().eq(1).text(t.title),r.children().eq(4).text(t.mediaSize);var i=this},n}),define("controller/forum",["core/mediaChooser"],function(e){var t=function(){this.page=null,this.mediaChooser=null,this.forwardButton="<button class='forwardButton'></button>",this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind_forwardFunction=this.forwardFunction.bind(this)};return t.TAG="Forum",t.Page={NEW:0,EDIT:1,DELETE:2},t.mediaChooserOptions=function(e){switch(e){case t.Page.NEW:case t.Page.EDIT:return{element:$("#files"),isPopUp:!0}}},t.prototype.bindUIEvents=function(e){console.log("%s: %s- page=%d",t.TAG,"bindUIEvents",e),this.page=e;switch(this.page){case t.Page.NEW:case t.Page.EDIT:this._bindUIEventsNewEdit();break;case t.Page.DELETE:this._bindUIEventsDelete()}},t.prototype._bindUIEventsNewEdit=function(){console.log("%s: %s",t.TAG,"_bindUIEventsNewEdit"),this.mediaChooser=new e(t.mediaChooserOptions(t.Page.NEW)),$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.RESET,this.bind__onReset),this.mediaChooser.bindUIEvents()},t.prototype._bindUIEventsDelete=function(){},t.prototype._onSuccess=function(e){switch(this.page){case t.Page.NEW:case t.Page.EDIT:$("#ForumForm_mediatextarea").val(e.media.id)}},t.prototype._onReset=function(e){switch(this.page){case t.Page.NEW:case t.Page.EDIT:$("#ForumForm_mediatextarea").val("")}},t.prototype.createVideoRecorder=function(e){console.log("%s: %s",t.TAG,"createVideoRecorder"),this.mediaChooser.createVideoRecorder({videoElement:e,forwardButtons:[this.forwardButton],forwardFunctions:[this.bind_forwardFunction]})},t.prototype.forwardFunction=function(){console.log("%s: %s",t.TAG,"forwardFunction"),this.mediaChooser.destroyVideoRecorder(),this.mediaChooser.previewMedia({type:e.TYPE_RECORD_VIDEO,mediaUrl:Routing.generate("imdc_myfiles_preview",{mediaId:this.mediaChooser.media.id}),mediaId:this.mediaChooser.media.id,recording:!0})},t}),define("controller/thread",["core/mediaChooser"],function(e){var t=function(){this.page=null,this.keyPoints=new Array,this.player=null,this.playerOptions=null,this.mediaChooser=null,this.forwardButton="<button class='forwardButton'></button>",this.doneButton="<button class='doneButton'></button>",this.doneAndPostButton="<button class='doneAndPostButton'></button>",this.videoSpeed=0,this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onSuccessAndPost=this._onSuccessAndPost.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind_forwardFunction=this.forwardFunction.bind(this),this.bind_doneFunction=this.doneFunction.bind(this),this.bind_doneAndPostFunction=this.doneAndPostFunction.bind(this)};return t.TAG="Thread",t.Page={NEW:0,EDIT:1,VIEW_THREAD:2},t.mediaChooserOptions=function(e){switch(e){case t.Page.NEW:case t.Page.EDIT:return{element:$("#files"),isPopUp:!0};case t.Page.VIEW_THREAD:return{element:$("#files"),isPopUp:!0,isNewPost:!0}}},t.prototype.bindUIEvents=function(e){console.log("%s: %s- page=%d",t.TAG,"bindUIEvents",e),this.page=e;switch(this.page){case t.Page.NEW:case t.Page.EDIT:this._bindUIEventsNewEdit(this.page==t.Page.EDIT);break;case t.Page.VIEW_THREAD:this._bindUIEventsViewThread()}},t.prototype._bindUIEventsNewEdit=function(n){console.log("%s: %s- isEdit=%s",t.TAG,"_bindUIEventsNewEdit",n),this.mediaChooser=new e(t.mediaChooserOptions(t.Page.NEW)),$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.SUCCESS_AND_POST,this.bind__onSuccessAndPost),$(this.mediaChooser).on(e.Event.RESET,this.bind__onReset),this.mediaChooser.bindUIEvents(),$("ul.tagit").hide();var r=n?"ThreadEditForm":"ThreadForm";$("#permissionRadioButtons div.radio").on("click",function(e){$("#"+r+"_permissions_accessLevel_2").is(":checked")?($("ul.tagit").show(),$("#"+r+"_permissions_userGroupsWithAccess").hide()):$("#"+r+"_permissions_accessLevel_3").is(":checked")?($("#"+r+"_permissions_userGroupsWithAccess").show(),$("ul.tagit").hide()):($("#"+r+"_permissions_userGroupsWithAccess").hide(),$("ul.tagit").hide())}),$("#permissionRadioButtons").trigger("click")},t.prototype._bindUIEventsViewThread=function(){console.log("%s: %s",t.TAG,"_bindUIEventsViewThread"),this.mediaChooser=new e(t.mediaChooserOptions(t.Page.VIEW_THREAD)),$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.SUCCESS_AND_POST,this.bind__onSuccessAndPost),$(this.mediaChooser).on(e.Event.RESET,this.bind__onReset),this.mediaChooser.bindUIEvents(),$("#videoSpeed").on("click",function(e){e.preventDefault(),this.videoSpeed=(this.videoSpeed+1)%3;switch(this.videoSpeed){case 0:this.playerOptions.mediaElement[0].playbackRate=1,$("#videoSpeed img").attr("src",this.playerOptions.speedImages.normal);break;case 1:this.playerOptions.mediaElement[0].playbackRate=2,$("#videoSpeed img").attr("src",this.playerOptions.speedImages.fast);break;case 2:this.playerOptions.mediaElement[0].playbackRate=.5,$("#videoSpeed img").attr("src",this.playerOptions.speedImages.slow);break;default:this.playerOptions.mediaElement[0].playbackRate=1,$("#videoSpeed img").attr("src",this.playerOptions.speedImages.normal)}}.bind(this)),$("#closedCaptions").on("click",function(e){e.preventDefault()}.bind(this)),$("#submitReply").on("click",function(e){$("#PostFormFromThread_startTime").val()==""&&$("#PostFormFromThread_endTime").val()==""&&$("#PostFormFromThread_content").val()==""&&this.mediaChooser.media==null&&(e.preventDefault(),alert("Your post cannot be blank. You must either make a Sign Link, select a file or write a comment."))}.bind(this)),$("#resetReply").on("click",function(e){e.preventDefault(),$("#PostFormFromThread_startTime").val(""),$("#PostFormFromThread_endTime").val(""),$("#PostFormFromThread_content").val(""),this.mediaChooser.setMedia(null),$("#PostFormFromThread_mediatextarea").val(""),this.player&&enableTemporalComment(this.player,!1,$("#PostFormFromThread_startTime"),$("#PostFormFromThread_endTime"))}.bind(this)),$(".post-goto-timeline-keypoint").on("click",function(e){e.preventDefault();var t=this.getKeyPointForPostId($(e.currentTarget).data("pid"));t.paintHighlightedTimeout=!0,t.paintHighlighted=!0,this.player.seek(t.startTime),this.player.redrawKeyPoints=!0,this.player.repaint(),setTimeout(function(){t.paintHighlightedTimeout=!1,t.paintHighlighted=!1,this.player.redrawKeyPoints=!0,this.player.repaint()}.bind(this),3e3)}.bind(this)),$(".post-goto-timeline-keypoint").hover(function(e){var t=this.getKeyPointForPostId($(e.currentTarget).data("pid"));t.paintHighlighted=!0,this.player.redrawKeyPoints=!0,this.player.repaint()}.bind(this),function(e){var t=this.getKeyPointForPostId($(e.currentTarget).data("pid"));if(t.paintHighlightedTimeout==1)return;t.paintHighlighted=!1,this.player.redrawKeyPoints=!0,this.player.repaint()}.bind(this)),$(".post-edit").on("click",function(e){e.preventDefault();var n=$(e.currentTarget).data("pid"),r={pid:n};$(".post-cancel").trigger("click"),$.ajax({url:Routing.generate("imdc_post_edit_ajax",r),type:"POST",contentType:"application/x-www-form-urlencoded",data:r,success:function(e){console.log("%s: %s: %s",t.TAG,".post-edit:click","success"),$("#containerPost"+n).hide(),$("#containerEditPost"+n).html(e.form),$("#containerEditPost"+n).show();var r=this.getKeyPointForPostId(n);r!=null&&r.options.drawOnTimeLine&&(this.player.seek(r.startTime),this.player.currentMinTimeSelected=r.startTime,this.player.currentMaxTimeSelected=r.endTime,this.player.currentMinSelected=this.player.getXForTime(this.player.currentMinTimeSelected),this.player.currentMaxSelected=this.player.getXForTime(this.player.currentMaxTimeSelected),enableTemporalComment(this.player,!0,$("#PostEditForm_startTime"),$("#PostEditForm_endTime")))}.bind(this),error:function(e){console.log("%s: %s: %s",t.TAG,".post-edit:click","error"),console.log(e.statusText)}})}.bind(this)),$(".post-delete").on("click",function(e){e.preventDefault();var t=$(this).data("pid");$("#modalDeleteButton").data("pid",t),$("#modalCancelButton").data("pid",t),$("#modaldiv").modal("toggle")}),$("#modalDeleteButton").on("click",function(e){e.preventDefault();var n=$("#modalDeleteButton").data("pid"),r={pid:n};$.ajax({url:Routing.generate("imdc_post_delete_ajax",r),type:"POST",contentType:"application/x-www-form-urlencoded",data:r,success:function(e){console.log("%s: %s: %s",t.TAG,"#modalDeleteButton:click","success");var r=$("#postContainer"+n);r.after('<div id="postDeleteSuccess" class="row"><div class="col-md-12"><p class="text-success"><i class="fa fa-check"></i> '+e.feedback+"</p></div></div>"),r.fadeOut("slow",function(){$(this).remove()}),this.player.removeKeyPoint(this.getKeyPointForPostId(n)),$("#modaldiv").modal("hide"),setTimeout(function(){$("#postDeleteSuccess").fadeOut("slow",function(e){$(this).remove()})},5e3)}.bind(this),error:function(e){console.log("%s: %s: %s",t.TAG,"#modalDeleteButton:click","error"),console.log(e.statusText),$("#modaldiv").modal("hide")}})}.bind(this)),$(".post-reply").on("click",function(e){e.preventDefault();var n=$(e.currentTarget).data("pid"),r={pid:n};$(".post-cancel").trigger("click"),$.ajax({url:Routing.generate("imdc_post_reply_ajax",r),type:"POST",contentType:"application/x-www-form-urlencoded",data:r,success:function(e){console.log("%s: %s: %s",t.TAG,".post-reply:click","success"),$("#postContainer"+n).append(e.form),$(".post-reply[data-pid="+n+"]").hide()},error:function(e){console.log("%s: %s: %s",t.TAG,".post-reply:click","error"),console.log(e.statusText)}})})},t.prototype.createKeyPoints=function(){console.log("%s: %s",t.TAG,"createKeyPoints"),$(".tt-post-container").each(function(e,t){this.keyPoints.push(new KeyPoint($(t).data("pid"),$(t).data("starttime"),$(t).data("endtime"),"comment",{drawOnTimeLine:$(t).data("istemporal")}))}.bind(this))},t.prototype.getKeyPointForPostId=function(e){console.log("%s: %s- postId=%d",t.TAG,"getKeyPointForId",e);for(kp in this.keyPoints){var n=this.keyPoints[kp];if(n.id==e)return n}},t.prototype.createPlayer=function(e){console.log("%s: %s",t.TAG,"createPlayer"),this.playerOptions=e,this.player=new Player(e.mediaElement,{areaSelectionEnabled:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,audioBar:!1,overlayControls:!0,playHeadImage:e.playHeadImage,playHeadImageOnClick:function(){this.player&&enableTemporalComment(this.player,!0,$("#PostFormFromThread_startTime"),$("#PostFormFromThread_endTime"))}.bind(this)}),this.player.setKeyPoints(this.keyPoints),this.player.createControls(),$(this.player).on(Player.EVENT_AREA_SELECTION_CHANGED,function(e){console.log("%s: %s",t.TAG,Player.EVENT_AREA_SELECTION_CHANGED),$("#PostFormFromThread_startTime").val(this.player.currentMinTimeSelected.toFixed(2)),$("#PostFormFromThread_endTime").val(this.player.currentMaxTimeSelected.toFixed(2)),$("#PostEditForm_startTime").val(this.player.currentMinTimeSelected.toFixed(2)),$("#PostEditForm_endTime").val(this.player.currentMaxTimeSelected.toFixed(2))}.bind(this)),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OVER,function(e,n,r){console.log("%s: %s- keypoint=%o, coords=%o",t.TAG,Player.EVENT_KEYPOINT_MOUSE_OVER,n,r),$("#postContainer"+n.id).addClass("tt-post-container-highlight"),$("#threadReplyContainer").is(":animated")||$("#threadReplyContainer").animate({scrollTop:$("#postContainer"+n.id).position().top},200)}),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OUT,function(e,n){console.log("%s: %s- keypoint=%o",t.TAG,Player.EVENT_KEYPOINT_MOUSE_OUT,n),$("#postContainer"+n.id).removeClass("tt-post-container-highlight")}),$(this.player).on(Player.EVENT_KEYPOINT_CLICK,function(e,n,r){console.log("%s: %s- keypoint=%o, coords=%o",t.TAG,Player.EVENT_KEYPOINT_CLICK,n,r)}),$(this.player).on(Player.EVENT_KEYPOINT_BEGIN,function(e,n){console.log("%s: %s- keypoint=%o",t.TAG,Player.EVENT_KEYPOINT_BEGIN,n)}),$(this.player).on(Player.EVENT_KEYPOINT_END,function(e,n){console.log("%s: %s- keypoint=%o",t.TAG,Player.EVENT_KEYPOINT_END,n)})},t.prototype._onSuccess=function(e){switch(this.page){case t.Page.NEW:case t.Page.EDIT:$("#ThreadForm_mediatextarea").val(e.media.id),console.log("successNEW/EDIT");break;case t.Page.VIEW_THREAD:$("#PostFormFromThread_mediatextarea").val(e.media.id),console.log("successVIEW")}},t.prototype._onSuccessAndPost=function(e){switch(this.page){case t.Page.NEW:case t.Page.EDIT:$("#ThreadForm_mediatextarea").val(e.media.id),console.log("successAndPostNEW/EDIT"),$("#submitForm").trigger("click");break;case t.Page.VIEW_THREAD:$("#PostFormFromThread_mediatextarea").val(e.media.id),console.log("successAndPostVIEW"),$("#submitReply").trigger("click")}},t.prototype._onReset=function(e){switch(this.page){case t.Page.NEW:case t.Page.EDIT:$("#ThreadForm_mediatextarea").val("");break;case t.Page.VIEW_THREAD:$("#PostFormFromThread_mediatextarea").val("")}},t.prototype.setPostTimelinePointForPost=function(e){console.log("%s: %s",t.TAG,"setPostTimelinePointForPost"),$(".tt-post-container").each(function(t,n){var r=$("#postTimelinePoint"+$(n).data("pid"));e.on("loadedmetadata",function(t){var i=e[0].duration,s=(100*$(n).data("starttime")/i).toFixed(2),o=(100*$(n).data("endtime")/i).toFixed(2),u=(o-s).toFixed(2);r.css({left:s+"%",width:u+"%"})}),isNaN(e[0].duration)||e.trigger("loadedmetadata"),r.on("click",function(e){$(".post-goto-timeline-keypoint[data-pid="+$(this).data("pid")+"]").trigger("click")}),r.hover(function(e){$(".post-goto-timeline-keypoint[data-pid="+$(this).data("pid")+"]").trigger("mouseenter")},function(e){$(".post-goto-timeline-keypoint[data-pid="+$(this).data("pid")+"]").trigger("mouseleave")})}.bind(this))},t.prototype.createVideoRecorder=function(e){console.log("%s: %s",t.TAG,"createVideoRecorder");var n=[this.forwardButton,this.doneButton],r=[this.bind_forwardFunction,this.bind_doneFunction];this.page==t.Page.VIEW_THREAD&&(n.push(this.doneAndPostButton),r.push(this.bind_doneAndPostFunction)),this.mediaChooser.createVideoRecorder({videoElement:e,forwardButtons:n,forwardFunctions:r})},t.prototype.forwardFunction=function(){console.log("%s: %s",t.TAG,"forwardFunction"),this.mediaChooser.destroyVideoRecorder(),this.mediaChooser.previewMedia({type:e.TYPE_RECORD_VIDEO,mediaUrl:Routing.generate("imdc_myfiles_preview",{mediaId:this.mediaChooser.media.id}),mediaId:this.mediaChooser.media.id,recording:!0})},t.prototype.doneFunction=function(){console.log("%s: %s",t.TAG,"doneFunction"),this.mediaChooser.destroyVideoRecorder(),this.mediaChooser._previewVideoForwardFunctionDone()},t.prototype.doneAndPostFunction=function(){console.log("%s: %s",t.TAG,"doneAndPostFunction"),this.mediaChooser.destroyVideoRecorder(),this.mediaChooser._previewVideoForwardFunctionDoneAndPost()},t}),$("#PostFormFromThread_startTime").on("blur",function(){var e=$(this).val();!e==""&&(globalPlayer.options.areaSelectionEnabled||enableTemporalComment(globalPlayer,!0,globalStartTimeInput,globalEndTimeInput),globalPlayer.setAreaSelectionStartTime(e),globalPlayer.seek(e))}),$("#PostFormFromThread_endTime").on("blur",function(){var e=$(this).val(),t=globalPlayer.getDuration();if(!$(this).val()==""){var n=$("#PostFormFromThread_startTime").val();n==""&&($("#PostFormFromThread_startTime").val(e-1),globalPlayer.setAreaSelectionStartTime(e-1)),e>t&&(e=t),globalPlayer.options.areaSelectionEnabled?globalPlayer.seek(Math.max(1,e)):(globalPlayer.seek(Math.max(1,e-1)),enableTemporalComment(globalPlayer,!0,globalStartTimeInput,globalEndTimeInput)),globalPlayer.setAreaSelectionEndTime(e)}}),define("controller/post",["core/mediaChooser"],function(e){var t=function(){this.page=null,this.mediaChooser=null,this.forwardButton="<button class='forwardButton'></button>",this.doneButton="<button class='doneButton'></button>",this.doneAndPostButton="<button class='doneAndPostButton'></button>",this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onSuccessAndPost=this._onSuccessAndPost.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind_forwardFunction=this.forwardFunction.bind(this),this.bind_doneFunction=this.doneFunction.bind(this),this.bind_doneAndPostFunction=this.doneAndPostFunction.bind(this)};return t.TAG="Post",t.Page={EDIT:0,REPLY:1},t.mediaChooserOptions=function(e,n){switch(e){case t.Page.EDIT:case t.Page.REPLY:return{element:$("#filesPost"+n),isPopUp:!0,isPost:!0,postId:n}}},t.prototype.bindUIEvents=function(e,n){console.log("%s: %s- page=%d, postId=%d",t.TAG,"bindUIEvents",e,n),this.page=e;switch(this.page){case t.Page.EDIT:this._bindUIEventsEdit(n);break;case t.Page.REPLY:this._bindUIEventsReply(n)}},t.prototype._bindUIEventsEdit=function(n){console.log("%s: %s- postId=%d",t.TAG,"_bindUIEventsEdit",n),this.mediaChooser=new e(t.mediaChooserOptions(t.Page.EDIT,n)),$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.SUCCESS_AND_POST,this.bind__onSuccessAndPost),$(this.mediaChooser).on(e.Event.RESET,this.bind__onReset),this.mediaChooser.bindUIEvents(),$("#cancelEditPost"+n).on("click",function(e){e.preventDefault(),$("#containerEditPost"+n).html(""),$("#containerEditPost"+n).hide(),$("#containerPost"+n).show(),thread.player&&enableTemporalComment(thread.player,!1,$("#PostEditForm_startTime"),$("#PostEditForm_endTime"))})},t.prototype._bindUIEventsReply=function(n){console.log("%s: %s- postId=%d",t.TAG,"_bindUIEventsReply",n),this.mediaChooser=new e(t.mediaChooserOptions(t.Page.REPLY,n)),$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.SUCCESS_AND_POST,this.bind__onSuccessAndPost),$(this.mediaChooser).on(e.Event.RESET,this.bind__onReset),this.mediaChooser.bindUIEvents(),$("#submitReplyPost"+n).on("click",function(e){$("#PostReplyToPostForm_content").val()==""&&this.mediaChooser.media==null&&(e.preventDefault(),alert("Your post cannot be blank. You must either select a file or write a comment."))}.bind(this)),$("#resetReplyPost"+n).on("click",function(e){e.preventDefault(),$("#PostReplyToPostForm_content").val(""),this.mediaChooser.setMedia(null),$(".mediatextarea-post-"+n).val("")}),$("#cancelReplyPost"+n).on("click",function(e){e.preventDefault(),$("#replyPostContainer"+n).remove(),$(".post-reply[data-pid="+n+"]").show()})},t.prototype._onSuccess=function(e){switch(this.page){case t.Page.EDIT:case t.Page.REPLY:$(".mediatextarea-post-"+e.postId).val(e.media.id)}},t.prototype._onSuccessAndPost=function(e){switch(this.page){case t.Page.EDIT:case t.Page.REPLY:$(".mediatextarea-post-"+e.postId).val(e.media.id),$("#PostReplyToPostForm_submit").trigger("click")}},t.prototype._onReset=function(e){switch(this.page){case t.Page.EDIT:case t.Page.REPLY:$(".mediatextarea-post-"+e.postId).val("")}},t.prototype.createVideoRecorder=function(e){console.log("%s: %s",t.TAG,"createVideoRecorder"),this.mediaChooser.createVideoRecorder({videoElement:e,forwardButtons:[this.forwardButton,this.doneButton,this.doneAndPostButton],forwardFunctions:[this.bind_forwardFunction,this.bind_doneFunction,this.bind_doneAndPostFunction]})},t.prototype.forwardFunction=function(){console.log("%s: %s",t.TAG,"forwardFunction"),this.mediaChooser.destroyVideoRecorder(),this.mediaChooser.previewMedia({type:e.TYPE_RECORD_VIDEO,mediaUrl:Routing.generate("imdc_myfiles_preview",{mediaId:this.mediaChooser.media.id}),mediaId:this.mediaChooser.media.id,recording:!0})},t.prototype.doneFunction=function(){console.log("%s: %s",t.TAG,"doneFunction"),this.mediaChooser.destroyVideoRecorder(),this.mediaChooser._previewVideoForwardFunctionDone()},t.prototype.doneAndPostFunction=function(){console.log("%s: %s",t.TAG,"doneAndPostFunction"),this.mediaChooser.destroyVideoRecorder(),this.mediaChooser._previewVideoForwardFunctionDoneAndPost()},t}),define("controller/group",["core/mediaChooser"],function(e){var t=function(){this.page=null,this.mediaChooser=null,this.forwardButton="<button class='forwardButton'></button>",this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind_forwardFunction=this.forwardFunction.bind(this)};return t.TAG="Group",t.Page={NEW:0,EDIT:1,ADD_MEMBERS:2},t.mediaChooserOptions=function(e){switch(e){case t.Page.NEW:case t.Page.EDIT:return{element:$("#files"),isPopUp:!0}}},t.prototype.bindUIEvents=function(e){console.log("%s: %s- page=%d",t.TAG,"bindUIEvents",e),this.page=e;switch(this.page){case t.Page.NEW:case t.Page.EDIT:this._bindUIEventsNewEdit();break;case t.Page.ADD_MEMBERS:this._bindUIEventsAddMembers()}},t.prototype._bindUIEventsNewEdit=function(){console.log("%s: %s",t.TAG,"_bindUIEventsNewEdit"),this.mediaChooser=new e(t.mediaChooserOptions(t.Page.NEW)),$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.RESET,this.bind__onReset),this.mediaChooser.bindUIEvents()},t.prototype._bindUIEventsAddMembers=function(){console.log("%s: %s",t.TAG,"_bindUIEventsAddMembers"),$(".group-member").on("click",function(e){var t=$(e.target),n=t.html()==t.data("selected");t.html(n?t.data("select"):t.data("selected")),t.removeClass(n?"btn-success group-member-selected":"btn-default"),t.addClass(n?"btn-default":"btn-success group-member-selected")}),$(".group-member").each(function(e,t){$(t).html($(t).data("select"))}),$("#addSelected").on("click",function(e){e.preventDefault();if($(".group-member-selected").length==0){alert("No members selected.");return}$(e.target).button("loading");var t=$("#addMembersForm .selected-users"),n=0;t.html(""),$(".group-member-selected").each(function(e,r){var i=t.data("prototype");i=i.replace(/__name__/g,n),t.append(i),$("."+n+"-id").val($(r).data("uid")),n++}),$("#addMembersForm form").submit()})},t.prototype._onSuccess=function(e){switch(this.page){case t.Page.NEW:case t.Page.EDIT:$("#UserGroupForm_userGroupForum_mediatextarea").val(e.media.id)}},t.prototype._onReset=function(e){switch(this.page){case t.Page.NEW:case t.Page.EDIT:$("#UserGroupForm_userGroupForum_mediatextarea").val("")}},t.prototype.createVideoRecorder=function(e){console.log("%s: %s",t.TAG,"createVideoRecorder"),this.mediaChooser.createVideoRecorder({videoElement:e,forwardButtons:[this.forwardButton],forwardFunctions:[this.bind_forwardFunction]})},t.prototype.forwardFunction=function(){console.log("%s: %s",t.TAG,"forwardFunction"),this.mediaChooser.destroyVideoRecorder(),this.mediaChooser.previewMedia({type:e.TYPE_RECORD_VIDEO,mediaUrl:Routing.generate("imdc_myfiles_preview",{mediaId:this.mediaChooser.media.id}),mediaId:this.mediaChooser.media.id,recording:!0})},t}),define("controller/message",[],function(){var e=function(){this.page=null};return e.TAG="Message",e.Page={NEW:0,REPLY:1,VIEW:2},e.prototype.bindUIEvents=function(t){console.log("%s: %s- page=%d",e.TAG,"bindUIEvents",t),this.page=t;switch(this.page){case e.Page.NEW:case e.Page.REPLY:this._bindUIEventsNewReply(this.page==e.Page.REPLY);break;case e.Page.VIEW:this._bindUIEventsView()}},e.prototype._bindUIEventsNewReply=function(t){console.log("%s: %s- isReply=%s",e.TAG,"_bindUIEventsNewReply",t);var n=t?"PrivateMessageReplyForm":"PrivateMessageForm";$("#"+n+"_recipients").tagit(),$("#showMediaButton").on("click",function(e){e.preventDefault(),$("#attachedMediaContainer").toggle()})},e.prototype._bindUIEventsView=function(){console.log("%s: %s",e.TAG,"_bindUIEventsView");var t=$(".tt-message-div").first().data("mid");$.post(Routing.generate("imdc_message_mark_as_read",{messageid:t}),{msgId:t},function(e){console.log("%s: %s: data=%o","mark message as read","success",e)})},e}),define("controller/profile",[],function(){var e=function(){this.page=null};return e.TAG="Profile",e.Page={EDIT:0},e.prototype.bindUIEvents=function(t){console.log("%s: %s",e.TAG,"bindUIEvents"),this.page=t;switch(t){case e.Page.EDIT:this._bindUIEventsEdit()}},e.prototype._bindUIEventsEdit=function(){console.log("%s: %s",e.TAG,"_bindUIEventsEdit"),$("#addAnotherLanguage").on("click",function(t){t.preventDefault(),e.addLanguage(this)}),$(".tt-delete-language").on("click",function(t){t.preventDefault(),e.deleteLanguage(this)})},e.addLanguage=function(t){var n=$("#foss_user_profile_form_languages"),r,i=n.data("delete-language-text"),s=n.data("prototype"),o=$("#foss_user_profile_form_languages > li").length;$("#no-languages").remove(),r=$('<button class="btn btn-danger btn-sm tt-delete-language"></a>').html(i),r.click(function(t){t.preventDefault(),e.deleteLanguage(this)}),s=s.replace(/__name__/g,o),o++;var u=$("<li></li>").html(s);u.append(r),$("#foss_user_profile_form_languages").append(u)},e.deleteLanguage=function(e){var t=$("#foss_user_profile_form_languages"),n=t.data("no-languages-text"),r=$('<span id="no-languages"></span>').html(n);$(e).parent().remove(),$("#foss_user_profile_form_languages > li").length==0&&$("#foss_user_profile_form_languages").append(r)},e}),define("main",["require","controller/myFiles","controller/forum","controller/thread","controller/post","controller/group","controller/message","controller/profile","core/mediaChooser","core/mediaManager"],function(e){var t={};t.Controller={},t.Controller.MyFiles=e("controller/myFiles"),t.Controller.Forum=e("controller/forum"),t.Controller.Thread=e("controller/thread"),t.Controller.Post=e("controller/post"),t.Controller.Group=e("controller/group"),t.Controller.Message=e("controller/message"),t.Controller.Profile=e("controller/profile"),t.Core={},t.Core.MediaChooser=e("core/mediaChooser"),t.Core.MediaManager=e("core/mediaManager"),window.TerpTube=t,$tt=window.TerpTube,$(".autosize").autosize()}),require(["main"]);